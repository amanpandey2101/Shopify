{% comment %}
  A snippet for text that stretches to fit the full width of it's container.
  @param [string] text - text to be rendered
{% endcomment %}

{% liquid
  assign shown_text = text | default: block.settings.text
  assign descenders = 'alphabetic'
  assign trim = 'trim-both'

  unless block.settings.case == 'uppercase'
    if shown_text contains 'g' or shown_text contains 'j' or shown_text contains 'p' or shown_text contains 'q' or shown_text contains 'y'
      assign descenders = 'text'
    endif
  endunless

  assign text_trim = trim | append: ' cap ' | append: descenders
  assign shown_text_with_line_breaks = shown_text | newline_to_br
  assign text_with_lines = shown_text_with_line_breaks | split: '<br />'
  assign nudge = '-0.04em'
%}

{% capture attributes %}
  style="
    --font-family: var(--font-{{ block.settings.font | default: 'accent'}}--family);
    --font-weight: var(--font-{{ block.settings.font | default: 'accent'}}--weight);
    {% if block.settings.font == 'body' %}
      --color: var(--color-foreground);
    {% else %}
      --color: var(--color-foreground-heading);
    {% endif %}
    --text-align: {{ block.settings.alignment | default: 'left' }};
    {% if block.settings.alignment == "left" %}
      --margin-left-nudge: {{nudge}};
    {% elsif block.settings.alignment == "right" %}
      --margin-right-nudge: {{nudge}};
    {% endif %}
    --line-height: {{ block.settings.line_height | default: '1' }};
    --letter-spacing: {{ block.settings.letter_spacing | default: '-0.03em' }};
    --text-transform: {{ block.settings.case | default: 'none' }};
    --text-trim: {{text_trim}};
  "
  {{ block.shopify_attributes }}
{% endcapture %}

<div class="jumbo-text__container">
  {% if text != blank %}
    <jumbo-text
      data-desktop-size="{{ block.settings.desktop_size_percentage | default: 100 }}"
      data-mobile-size="{{ block.settings.mobile_size_percentage | default: 100 }}"
      {{ attributes }}
    >{{ text }}</jumbo-text>
  {% else %}
    <jumbo-text
      data-desktop-size="{{ block.settings.desktop_size_percentage | default: 100 }}"
      data-mobile-size="{{ block.settings.mobile_size_percentage | default: 100 }}"
      {{ attributes }}
      aria-label="{{ shown_text }}"
      data-text-effect="{{ block.settings.text_effect }}"
      data-animation-repeat="{{ block.settings.animation_repeat }}"
    >
      {%- assign char_index = 0 -%}
      {%- for line in text_with_lines -%}
        {%- if forloop.index > 1 -%}
          <br>
        {%- endif -%}
        <span
          class="jumbo-text-line"
          style="--line-index: {{ forloop.index }};"
          data-testid="jumbo-text-line"
        >
          {%- assign chars = line | split: ' ' | join: ' ' | split: '' -%}
          {%- for char in chars -%}
            {%- if char == ' ' -%}
              <span
                class="jumbo-text-space"
                aria-hidden="true"
              >
                {{ char }}
              </span>
            {%- else -%}
              <span
                class="jumbo-text-char"
                style="--char-index: {{ char_index }};"
                aria-hidden="true"
              >
                <span class="jumbo-text-char-inner">{{ char }}</span>
              </span>
              {%- assign char_index = char_index | plus: 1 -%}
            {%- endif -%}
          {%- endfor -%}
        </span>
      {%- endfor -%}
    </jumbo-text>
  {% endif %}
</div>

<script
  src="{{ 'jumbo-text.js' | asset_url }}"
  type="module"
></script>

{% stylesheet %}
  /* Your existing stylesheet code here */
{% endstylesheet %}